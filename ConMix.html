<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ConMix - Concrete Mix Design Calculator</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        * {
            font-family: "Times New Roman", serif;
            box-sizing: border-box;
        }
        
        body {
            background-color: #a7a59c;
            color: #333;
            margin: 0;
            padding: 0;
            line-height: 1.5;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            background: linear-gradient(135deg, #1a2a57, #2c3e50);
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            position: relative;
            overflow: hidden;
            flex-wrap: wrap;
        }
        
        .header::before {
            content: "";
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,215,0,0.1) 0%, transparent 70%);
            z-index: 0;
        }
        
        .logo-container {
            display: flex;
            align-items: center;
            gap: 15px;
            z-index: 1;
            flex: 1;
            min-width: 300px;
        }
        
        .logo {
            width: 60px;
            height: 60px;
            background-color: #ffd700;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 14px;
            color: #1a2a57;
            text-align: center;
            padding: 5px;
            box-shadow: 0 0 15px rgba(255,215,0,0.5);
        }
        
        .header-text {
            z-index: 1;
        }
        
        .software-name {
            font-size: 32px;
            font-weight: bold;
            margin: 0;
            color: #ffd700;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            letter-spacing: 1px;
        }
        
        .software-subtitle {
            font-size: 16px;
            margin: 5px 0 0 0;
            opacity: 0.9;
        }
        
        .google-login-btn {
            background-color: #4285f4;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s ease;
            z-index: 1;
        }
        
        .google-login-btn:hover {
            background-color: #3367d6;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .google-icon {
            width: 18px;
            height: 18px;
        }
        
        .user-panel {
            display: none;
            align-items: center;
            gap: 15px;
            color: white;
            z-index: 1;
            flex-wrap: wrap;
            justify-content: flex-end;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .user-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #4299e1;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
        }
        
        .logout-btn {
            background: transparent;
            border: 1px solid #63b3ed;
            color: #63b3ed;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .previous-data-btn {
            background: #ffd700;
            color: #1a2a57;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
        }
        
        .logout-btn:hover {
            background: rgba(99, 179, 237, 0.1);
        }
        
        .previous-data-btn:hover {
            background: #e6c200;
        }
        
        .section {
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        h1, h2, h3 {
            color: #2c3e50;
        }
        
        .input-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .input-group {
            display: flex;
            flex-direction: column;
        }
        
        label {
            margin-bottom: 5px;
            font-weight: bold;
            font-size: 14px;
        }
        
        input, select {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        
        button {
            background-color: #2c3e50;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin-top: 10px;
            transition: background-color 0.3s;
        }
        
        button:hover {
            background-color: #1a2a57;
        }
        
        .calculation-box {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            margin: 10px 0;
            border-left: 4px solid #2c3e50;
        }
        
        .result-box {
            background-color: #e8f4fd;
            padding: 15px;
            border-radius: 6px;
            margin: 15px 0;
            border: 1px solid #bee5eb;
        }
        
        .target-strength-box {
            background-color: #fff3cd;
            padding: 15px;
            border-radius: 6px;
            margin: 15px 0;
            border: 1px solid #ffeaa7;
            text-align: center;
            font-size: 18px;
            font-weight: bold;
        }
        
        .target-strength-preview {
            background-color: #ffcce6;
            padding: 10px;
            border-radius: 4px;
            margin-top: 10px;
            text-align: center;
            font-weight: bold;
            border: 1px solid #ff99cc;
            display: none;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 10px 0;
            font-size: 14px;
        }
        
        th, td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: left;
        }
        
        th {
            background-color: #f2f2f2;
            font-weight: bold;
        }
        
        .highlight-row {
            background-color: #fff3cd !important;
            font-weight: bold;
        }
        
        .highlight-cell {
            background-color: #d4edda !important;
            font-weight: bold;
            border: 2px solid #28a745 !important;
        }
        
        .chart-container {
            height: 350px;
            margin: 20px 0;
        }
        
        .flex-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .flex-item {
            flex: 1;
            min-width: 300px;
        }
        
        .highlight {
            background-color: #fff3cd;
            padding: 5px;
            border-radius: 3px;
            font-weight: bold;
        }
        
        .formula {
            font-style: italic;
            background-color: #f8f9fa;
            padding: 10px;
            border-left: 3px solid #2c3e50;
            margin: 10px 0;
        }
        
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .checkbox-group label {
            margin-bottom: 0;
            font-weight: normal;
        }
        
        .radio-group {
            display: flex;
            gap: 20px;
            margin: 10px 0;
            flex-wrap: wrap;
        }
        
        .radio-group label {
            display: flex;
            align-items: center;
            gap: 5px;
            font-weight: normal;
        }
        
        .footer {
            text-align: center;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #ddd;
        }
        
        .visitor-counter {
            font-size: 18px;
            font-weight: bold;
            margin-top: 15px;
            color: #2c3e50;
        }
        
        .action-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .save-btn {
            background-color: #28a745;
        }
        
        .previous-btn {
            background-color: #17a2b8;
        }
        
        .saved-data {
            margin-top: 30px;
        }
        
        .saved-data-item {
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .saved-data-item:hover {
            background-color: #f8f9fa;
        }
        
        .open-btn {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 5px;
        }
        
        .delete-btn {
            background-color: #dc3545;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 5px;
        }
        
        .print-btn {
            background-color: #28a745;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .message {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            text-align: center;
            font-weight: bold;
        }
        
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background: white;
            width: 90%;
            max-width: 500px;
            border-radius: 10px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            overflow: hidden;
            animation: modalAppear 0.3s ease;
        }
        
        @keyframes modalAppear {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .modal-header {
            background: linear-gradient(90deg, #1a3a5f, #2c5282);
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-header h2 {
            margin: 0;
            font-size: 1.5rem;
            color: white;
        }
        
        .close-btn {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
        }
        
        .modal-body {
            padding: 20px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        .form-group input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        
        .form-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .btn-cancel {
            background: #a0aec0;
            color: white;
            flex: 1;
        }
        
        .btn-submit {
            background: #4299e1;
            color: white;
            flex: 2;
        }
        
        .password-note {
            background-color: #fff3cd;
            padding: 10px;
            border-radius: 4px;
            margin-top: 15px;
            text-align: center;
            font-style: italic;
            font-size: 14px;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        
        .graph-disclaimer {
            background-color: #fff3cd;
            padding: 10px;
            border-radius: 4px;
            margin-top: 10px;
            text-align: center;
            font-style: italic;
            font-size: 14px;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        
        .ai-disclaimer {
            background-color: #fff3cd;
            padding: 15px;
            border-radius: 6px;
            margin-top: 20px;
            text-align: center;
            font-style: italic;
            font-size: 14px;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        
        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                text-align: center;
                gap: 15px;
            }
            
            .logo {
                margin-right: 0;
                margin-bottom: 0;
            }
            
            .software-name {
                font-size: 28px;
            }
            
            .input-grid {
                grid-template-columns: 1fr;
            }
            
            .flex-container {
                flex-direction: column;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .google-login-btn {
                width: 100%;
                justify-content: center;
            }
            
            .user-panel {
                flex-direction: column;
                gap: 10px;
            }
            
            .radio-group {
                flex-direction: column;
                gap: 10px;
            }
            
            table {
                font-size: 12px;
            }
            
            th, td {
                padding: 5px;
            }
            
            .chart-container {
                height: 250px;
            }
        }
        
        @media (max-width: 480px) {
            .container {
                padding: 10px;
            }
            
            .section {
                padding: 15px;
            }
            
            .header {
                padding: 10px 15px;
            }
            
            .software-name {
                font-size: 24px;
            }
            
            .input-grid {
                gap: 10px;
            }
            
            .modal-content {
                width: 95%;
            }
        }

        .duplicate-highlight {
            animation: blink 1s 5;
            background-color: #ffcccc !important;
            border: 2px solid #ff0000 !important;
        }
        
        @keyframes blink {
            0% { background-color: #ffcccc; }
            50% { background-color: #ff9999; }
            100% { background-color: #ffcccc; }
        }
        
        .restricted-input {
            background-color: #ffe6e6;
            border-color: #ff9999;
        }
        
        .restricted-label {
            color: #cc0000;
        }
        
        .restricted-note {
            color: #cc0000;
            font-size: 12px;
            margin-top: 5px;
        }
        
        .auto-adjusted {
            background-color: #e6ffe6 !important;
            border-color: #66cc66 !important;
            animation: pulse 1s;
        }
        
        @keyframes pulse {
            0% { background-color: #e6ffe6; }
            50% { background-color: #b3ffb3; }
            100% { background-color: #e6ffe6; }
        }
        
        .adjustment-message {
            background-color: #e6f7ff;
            border-left: 4px solid #1890ff;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .hidden-section {
            display: none;
        }
        
        .adjustment-input-group {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
            flex-wrap: wrap;
        }
        
        .adjustment-input-group label {
            min-width: 150px;
            margin-bottom: 0;
        }
        
        .adjustment-input-group input {
            width: 100px;
        }
        
        .adjustment-input-group span {
            font-weight: bold;
            color: #2c3e50;
        }
        
        .auto-switch-message {
            background-color: #e6f7ff;
            border-left: 4px solid #1890ff;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .steel-fiber-calculation {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            margin: 15px 0;
            border-left: 4px solid #2c3e50;
        }
        
        .wcr-restriction-info {
            background-color: #e6f7ff;
            border-left: 4px solid #1890ff;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .warning-message {
            background-color: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .input-valid {
            border-color: #28a745;
            background-color: #f8fff8;
        }
        
        .input-invalid {
            border-color: #dc3545;
            background-color: #fff8f8;
        }
        
        .validation-message {
            font-size: 12px;
            margin-top: 5px;
            display: none;
        }
        
        .validation-message.valid {
            color: #28a745;
            display: block;
        }
        
        .validation-message.invalid {
            color: #dc3545;
            display: block;
        }
        
        .login-required-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 8px;
            z-index: 10;
        }
        
        .login-required-message {
            background: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header Section with Google Login -->
        <div class="header">
            <div class="logo-container">
                <div class="logo">
                    <div style="display: flex; align-items: center; justify-content: center; width: 100%; height: 100%;">
                        <span style="font-size: 12px; font-weight: bold;">ConMix</span>
                    </div>
                </div>
                <div class="header-text">
                    <h1 class="software-name">ConMix</h1>
                    <p class="software-subtitle">Concrete Mix Design Proportioning Calculator</p>
                     <p class="software-subtitle"><b>IS 10262 : 2019 & IS 456 : 2000</b></p>
                </div>
            </div>
            
            <div class="google-login-container" id="googleLoginContainer">
                <button class="google-login-btn" id="googleLoginBtn">
                    <svg class="google-icon" viewBox="0 0 24 24" width="24" height="24" xmlns="http://www.w3.org/2000/svg">
                        <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                        <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                        <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                        <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                    </svg>
                    Sign in with Google
                </button>
            </div>
            
            <div class="user-panel" id="userPanel">
                <div class="user-info">
                    <div class="user-icon" id="userIcon">U</div>
                    <span id="userName">User</span>
                </div>
                <button class="previous-data-btn" id="previousDataBtn">Previous Data</button>
                <button class="logout-btn" id="logoutBtn">Logout</button>
            </div>
        </div>
        
        <!-- Material Properties Input Section -->
        <div class="section" id="materialPropertiesSection">
            <h2>Material Properties Input</h2>
            <div id="adjustmentMessage" class="adjustment-message" style="display: none;">
                <!-- Auto-adjustment messages will appear here -->
            </div>
            <div id="autoSwitchMessage" class="auto-switch-message" style="display: none;">
                <!-- Auto-switch messages will appear here -->
            </div>
            <div class="input-grid">
                <div class="input-group">
                    <label for="concreteType">Type of Concrete</label>
                    <select id="concreteType">
                        <option value="conventional">Conventional Concrete</option>
                        <option value="highStrength">High Strength Concrete</option>
                    </select>
                </div>
                
                <div class="input-group">
                    <label for="grade" id="gradeLabel">Grade of Concrete</label>
                    <select id="grade">
                        <option value="10">M10</option>
                        <option value="15">M15</option>
                        <option value="20">M20</option>
                        <option value="25">M25</option>
                        <option value="30" selected>M30</option>
                        <option value="35">M35</option>
                        <option value="40">M40</option>
                        <option value="45">M45</option>
                        <option value="50">M50</option>
                        <option value="55">M55</option>
                        <option value="60">M60</option>
                        <option value="65">M65</option>
                        <option value="70">M70</option>
                        <option value="75">M75</option>
                        <option value="80">M80</option>
                        <option value="85">M85</option>
                        <option value="90">M90</option>
                        <option value="95">M95</option>
                        <option value="100">M100</option>
                        <option value="105">M105</option>
                        <option value="110">M110</option>
                        <option value="115">M115</option>
                        <option value="120">M120</option>
                    </select>
                    <div id="targetStrengthPreview" class="target-strength-preview">
                        <!-- Target strength preview will appear here -->
                    </div>
                </div>
                
                <div class="input-group">
                    <label for="cementType">Cement Type</label>
                    <select id="cementType">
                        <option value="OPC">OPC</option>
                        <option value="PPC">PPC</option>
                    </select>
                </div>
                
                <div class="input-group">
                    <label for="aggSize">Nominal Maximum Aggregate Size (mm)</label>
                    <select id="aggSize">
                        <option value="10">10 mm</option>
                        <option value="20" selected>20 mm</option>
                        <option value="40">40 mm</option>
                    </select>
                </div>
                
                <div class="input-group">
                    <label for="zone">Zone of Fine Aggregate</label>
                    <select id="zone">
                        <option value="I">Zone I</option>
                        <option value="II" selected>Zone II</option>
                        <option value="III">Zone III</option>
                        <option value="IV">Zone IV</option>
                    </select>
                </div>
                
                <div class="input-group">
                    <label for="slump">Required Slump (mm)</label>
                    <input type="number" id="slump" value="75" min="25" max="175">
                    <div class="validation-message" id="slumpValidation"></div>
                </div>
                
                <div class="input-group">
                    <label for="spGravityCement">Specific Gravity of Cement</label>
                    <input type="number" id="spGravityCement" value="3.15" step="0.01" min="2.5" max="3.5">
                    <div class="validation-message" id="spGravityCementValidation"></div>
                </div>
                
                <div class="input-group">
                    <label for="spGravityFA">Specific Gravity of Fine Aggregate</label>
                    <input type="number" id="spGravityFA" value="2.65" step="0.01" min="2.0" max="3.0">
                    <div class="validation-message" id="spGravityFAValidation"></div>
                </div>
                
                <div class="input-group">
                    <label for="spGravityCA">Specific Gravity of Coarse Aggregate</label>
                    <input type="number" id="spGravityCA" value="2.70" step="0.01" min="2.0" max="3.0">
                    <div class="validation-message" id="spGravityCAValidation"></div>
                </div>
                
                <div class="input-group">
                    <label for="absorptionFA">Water Absorption of FA (%)</label>
                    <input type="number" id="absorptionFA" value="1.0" step="0.1" min="0" max="5">
                    <div class="validation-message" id="absorptionFAValidation"></div>
                </div>
                
                <div class="input-group">
                    <label for="absorptionCA">Water Absorption of CA (%)</label>
                    <input type="number" id="absorptionCA" value="0.5" step="0.1" min="0" max="5">
                    <div class="validation-message" id="absorptionCAValidation"></div>
                </div>
                
                <!-- Water-Cement Ratio Input -->
                <div class="input-group">
                    <label for="waterCementRatio" id="waterCementRatioLabel">Water-Cement Ratio</label>
                    <input type="number" id="waterCementRatio" value="0.45" step="0.01" min="0.3" max="0.7">
                    <div class="validation-message" id="waterCementRatioValidation"></div>
                    <div id="wcrRestrictionInfo" class="wcr-restriction-info" style="display: none;">
                        <!-- WCR restriction info will appear here -->
                    </div>
                </div>
            </div>
            
            <!-- Fly Ash Properties (Hidden when PPC is selected) -->
            <div id="flyAshSection">
                <h3>Fly Ash Properties (Optional)</h3>
                <div class="input-grid">
                    <div class="input-group">
                        <label for="useFlyAsh" id="useFlyAshLabel">Use Fly Ash</label>
                        <div class="checkbox-group">
                            <input type="checkbox" id="useFlyAsh">
                            <label for="useFlyAsh">Yes</label>
                        </div>
                        <div id="flyAshRestrictionNote" class="restricted-note" style="display: none;">Fly ash cannot be used with PPC cement</div>
                    </div>
                    
                    <div class="input-group">
                        <label for="flyAshPercentage">Fly Ash Percentage (% of cementitious material)</label>
                        <input type="number" id="flyAshPercentage" value="20" step="1" min="0" max="35" disabled>
                        <div class="validation-message" id="flyAshPercentageValidation"></div>
                    </div>
                    
                    <div class="input-group">
                        <label for="spGravityFlyAsh">Specific Gravity of Fly Ash</label>
                        <input type="number" id="spGravityFlyAsh" value="2.2" step="0.01" min="1.5" max="3.0" disabled>
                        <div class="validation-message" id="spGravityFlyAshValidation"></div>
                    </div>
                </div>
            </div>
            
            <h3>Admixture Properties (Optional)</h3>
            <div class="input-grid">
                <div class="input-group">
                    <label for="useAdmixture">Use Chemical Admixture</label>
                    <div class="checkbox-group">
                        <input type="checkbox" id="useAdmixture" checked>
                        <label for="useAdmixture">Yes</label>
                    </div>
                </div>
                
                <div class="input-group">
                    <label for="admixturePercentage">Admixture Percentage (% of cementitious material)</label>
                    <input type="number" id="admixturePercentage" value="1.0" step="0.1" min="0" max="5">
                    <div class="validation-message" id="admixturePercentageValidation"></div>
                </div>
                
                <div class="input-group">
                    <label for="spGravityAdmixture">Specific Gravity of Admixture</label>
                    <input type="number" id="spGravityAdmixture" value="1.2" step="0.01" min="1.0" max="1.5">
                    <div class="validation-message" id="spGravityAdmixtureValidation"></div>
                </div>
                
                <div class="input-group">
                    <label for="waterReduction">Water Reduction Percentage (%)</label>
                    <input type="number" id="waterReduction" value="23" step="1" min="0" max="40">
                    <div class="validation-message" id="waterReductionValidation"></div>
                </div>
            </div>
            
            <!-- Steel Fiber Properties (Only for High Strength Concrete) -->
            <div id="steelFiberSection" class="hidden-section">
                <h3>Steel Fiber Properties (Optional for High Strength Concrete)</h3>
                <div class="input-grid">
                    <div class="input-group">
                        <label for="useSteelFibers">Use Steel Fibers</label>
                        <div class="checkbox-group">
                            <input type="checkbox" id="useSteelFibers">
                            <label for="useSteelFibers">Yes</label>
                        </div>
                    </div>
                    
                    <div class="input-group">
                        <label for="steelFiberPercentage">Steel Fiber Percentage (% by volume of concrete)</label>
                        <input type="number" id="steelFiberPercentage" value="1.0" step="0.1" min="1" max="10" disabled>
                        <div class="validation-message" id="steelFiberPercentageValidation"></div>
                    </div>
                    
                    <div class="input-group">
                        <label for="spGravitySteelFibers">Specific Gravity of Steel Fibers</label>
                        <input type="number" id="spGravitySteelFibers" value="7.85" step="0.01" min="7.0" max="8.0" disabled>
                        <div class="validation-message" id="spGravitySteelFibersValidation"></div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Material Adjustments Section (Only for High Strength Concrete with Steel Fibers) -->
        <div id="adjustmentsSection" class="section hidden-section">
            <h2>Material Adjustments for High Strength Concrete with Steel Fibers</h2>
            <p>Adjust the material quantities based on steel fiber addition. Values are percentage adjustments.</p>
            
            <div class="adjustment-input-group">
                <label for="waterAdjustment">Water Adjustment (%)</label>
                <input type="number" id="waterAdjustment" value="0" step="0.1" min="1" max="10">
                <span>+</span>
                <p style="font-size: 12px; color: #666;">Applied only if superplasticizer is not used</p>
            </div>
            
            <div class="adjustment-input-group">
                <label for="cementAdjustment">Cement Adjustment (%)</label>
                <input type="number" id="cementAdjustment" value="0" step="0.1" min="1" max="10">
                <span>+</span>
            </div>
            
            <div class="adjustment-input-group">
                <label for="fineAggregateAdjustment">Fine Aggregate Adjustment (%)</label>
                <input type="number" id="fineAggregateAdjustment" value="0" step="0.1" min="1" max="10">
                <span>-</span>
            </div>
            
            <div class="adjustment-input-group">
                <label for="coarseAggregateAdjustment">Coarse Aggregate Adjustment (%)</label>
                <input type="number" id="coarseAggregateAdjustment" value="0" step="0.1" min="1" max="10">
                <span>-</span>
            </div>
            
            <div id="flyAshAdjustmentGroup" class="adjustment-input-group hidden-section">
                <label for="flyAshAdjustment">Fly Ash Adjustment (%)</label>
                <input type="number" id="flyAshAdjustment" value="0" step="0.1" min="1" max="15">
                <span>-</span>
            </div>
        </div>
        
        <!-- Exposure Conditions Table -->
        <div class="section">
            <h2>Exposure Conditions (IS 456 Table 5)</h2>
            
            <div class="input-group">
                <label for="exposure">Select Exposure Condition</label>
                <select id="exposure">
                    <option value="mild">Mild</option>
                    <option value="moderate">Moderate</option>
                    <option value="severe" selected>Severe</option>
                    <option value="verySevere">Very Severe</option>
                    <option value="extreme">Extreme</option>
                </select>
            </div>
            
            <div class="radio-group">
                <label>
                    <input type="radio" name="concreteType" value="plain" id="plainConcrete">
                    Plain Concrete
                </label>
                <label>
                    <input type="radio" name="concreteType" value="reinforced" id="reinforcedConcrete" checked>
                    Reinforced Concrete
                </label>
            </div>
            
            <div style="overflow-x: auto;">
                <table id="exposureTable">
                    <tr>
                        <th rowspan="2">Exposure Condition</th>
                        <th colspan="3">Plain Concrete</th>
                        <th colspan="3">Reinforced Concrete</th>
                    </tr>
                    <tr>
                        <th>Min. Cement (kg/m³)</th>
                        <th>Max. W/C Ratio</th>
                        <th>Min. Grade</th>
                        <th>Min. Cement (kg/m³)</th>
                        <th>Max. W/C Ratio</th>
                        <th>Min. Grade</th>
                    </tr>
                    <tr id="mildRow">
                        <td>Mild</td>
                        <td id="mildPlainCement">220</td>
                        <td id="mildPlainWCR">0.60</td>
                        <td id="mildPlainGrade">--</td>
                        <td id="mildReinforcedCement">300</td>
                        <td id="mildReinforcedWCR">0.55</td>
                        <td id="mildReinforcedGrade">M20</td>
                    </tr>
                    <tr id="moderateRow">
                        <td>Moderate</td>
                        <td id="moderatePlainCement">240</td>
                        <td id="moderatePlainWCR">0.60</td>
                        <td id="moderatePlainGrade">M15</td>
                        <td id="moderateReinforcedCement">300</td>
                        <td id="moderateReinforcedWCR">0.50</td>
                        <td id="moderateReinforcedGrade">M25</td>
                    </tr>
                    <tr id="severeRow">
                        <td>Severe</td>
                        <td id="severePlainCement">250</td>
                        <td id="severePlainWCR">0.50</td>
                        <td id="severePlainGrade">M20</td>
                        <td id="severeReinforcedCement">320</td>
                        <td id="severeReinforcedWCR">0.45</td>
                        <td id="severeReinforcedGrade">M30</td>
                    </tr>
                    <tr id="verySevereRow">
                        <td>Very Severe</td>
                        <td id="verySeverePlainCement">260</td>
                        <td id="verySeverePlainWCR">0.45</td>
                        <td id="verySeverePlainGrade">M20</td>
                        <td id="verySevereReinforcedCement">340</td>
                        <td id="verySevereReinforcedWCR">0.45</td>
                        <td id="verySevereReinforcedGrade">M35</td>
                    </tr>
                    <tr id="extremeRow">
                        <td>Extreme</td>
                        <td id="extremePlainCement">280</td>
                        <td id="extremePlainWCR">0.40</td>
                        <td id="extremePlainGrade">M25</td>
                        <td id="extremeReinforcedCement">360</td>
                        <td id="extremeReinforcedWCR">0.40</td>
                        <td id="extremeReinforcedGrade">M25</td>
                    </tr>
                </table>
            </div>
            <p style="margin-top: 10px; font-style: italic;">The highlighted cells show the requirements for the selected exposure condition and concrete type.</p>
        </div>
        
        <!-- Calculate Button -->
        <div class="section" style="text-align: center;">
            <button id="calculateMixBtn" style="padding: 15px 30px; font-size: 18px;">Calculate Mix Proportions</button>
        </div>
        
        <!-- Calculation Results -->
        <div id="results" style="display: none;">
            <!-- Target Strength Section -->
            <div class="section">
                <h2>1. Target Strength for Mix Proportioning</h2>
                <p class="formula">f'<sub>ck</sub> = f<sub>ck</sub> + 1.65 × S <strong>OR</strong> f<sub>ck</sub> + X (whichever is higher)</p>
                <p>Where:<br>
                f'<sub>ck</sub> = Target average compressive strength at 28 days<br>
                f<sub>ck</sub> = Characteristic compressive strength at 28 days<br>
                S = Standard deviation<br>
                X = Factor based on grade of concrete</p>
                
                <div id="targetStrengthCalc" class="calculation-box">
                    <!-- Calculation will appear here -->
                </div>
            </div>
            
            <!-- Air Content Section -->
            <div class="section">
                <h2>2. Approximate Air Content</h2>
                <div style="overflow-x: auto;">
                    <table>
                        <tr>
                            <th>Nominal Maximum Size of Aggregate (mm)</th>
                            <th>Entrapped Air (% of Volume)</th>
                        </tr>
                        <tr>
                            <td>10</td>
                            <td>1.5</td>
                        </tr>
                        <tr>
                            <td>20</td>
                            <td>1.0</td>
                        </tr>
                        <tr>
                            <td>40</td>
                            <td>0.8</td>
                        </tr>
                    </table>
                </div>
                
                <div id="airContent" class="calculation-box">
                    <!-- Calculation will appear here -->
                </div>
            </div>
            
            <!-- Water Content Section -->
            <div class="section">
                <h2>3. Selection of Water Content</h2>
                <div style="overflow-x: auto;">
                    <table>
                        <tr>
                            <th>Nominal Maximum Size of Aggregate (mm)</th>
                            <th>Water Content (kg/m³)</th>
                        </tr>
                        <tr>
                            <td>10</td>
                            <td>208</td>
                        </tr>
                        <tr>
                            <td>20</td>
                            <td>186</td>
                        </tr>
                        <tr>
                            <td>40</td>
                            <td>165</td>
                        </tr>
                    </table>
                </div>
                
                <div id="waterContentCalc" class="calculation-box">
                    <!-- Water content calculation will appear here -->
                </div>
            </div>
            
            <!-- Cement Content Section -->
            <div class="section">
                <h2>4. Calculation of Cement Content</h2>
                <p class="formula">Cement Content = Water Content / Water-Cement Ratio</p>
                
                <div id="cementContentCalc" class="calculation-box">
                    <!-- Cement content calculation will appear here -->
                </div>
                
                <div id="exposureCheck" class="calculation-box">
                    <!-- Exposure condition check will appear here -->
                </div>
            </div>
            
            <!-- Aggregate Proportion Section -->
            <div class="section">
                <h2>5. Proportion of Volume of Coarse Aggregate and Fine Aggregate Content</h2>
                <div style="overflow-x: auto;">
                    <table>
                        <tr>
                            <th rowspan="2">Nominal Maximum Size of Aggregate (mm)</th>
                            <th colspan="4">Volume of Coarse Aggregate per Unit Volume of Total Aggregate</th>
                        </tr>
                        <tr>
                            <th>Zone IV</th>
                            <th>Zone III</th>
                            <th>Zone II</th>
                            <th>Zone I</th>
                        </tr>
                        <tr>
                            <td>10</td>
                            <td>0.54</td>
                            <td>0.52</td>
                            <td>0.50</td>
                            <td>0.48</td>
                        </tr>
                        <tr>
                            <td>20</td>
                            <td>0.66</td>
                            <td>0.64</td>
                            <td>0.62</td>
                            <td>0.60</td>
                        </tr>
                        <tr>
                            <td>40</td>
                            <td>0.73</td>
                            <td>0.72</td>
                            <td>0.71</td>
                            <td>0.69</td>
                        </tr>
                    </table>
                </div>
                
                <div id="aggregateProportion" class="calculation-box">
                    <!-- Aggregate proportion calculation will appear here -->
                </div>
            </div>
            
            <!-- Steel Fiber Calculation Section (if applicable) -->
            <div id="steelFiberCalcSection" class="section hidden-section">
                <h2>Steel Fiber Calculation</h2>
                <div id="steelFiberCalc" class="steel-fiber-calculation">
                    <!-- Steel fiber calculation will appear here -->
                </div>
            </div>
            
            <!-- Mix Calculations Section -->
            <div class="section">
                <h2>Mix Calculations</h2>
                <div id="mixCalculations" class="calculation-box">
                    <!-- Mix calculations will appear here -->
                </div>
            </div>
            
            <!-- Final Mix Proportions Section -->
            <div class="section">
                <h2>Final Mix Proportions (per m³ of Concrete)</h2>
                <div id="finalProportions" class="result-box">
                    <!-- Final proportions will appear here -->
                </div>
            </div>
            
            <!-- Material Quantities Pie Chart -->
            <div class="section">
                <h2>Material Quantities Distribution</h2>
                <div class="chart-container">
                    <canvas id="materialChart"></canvas>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="action-buttons">
                <button class="save-btn" onclick="saveData()">Save Data</button>
                <button class="previous-btn" onclick="toggleSavedData()">Previous Data</button>
            </div>
            
            <!-- Message Display Area -->
            <div id="messageArea"></div>
        </div>
        
        <!-- Saved Data Section -->
        <div id="savedData" class="section" style="display: none;">
            <h2>Your Saved Data</h2>
            <div style="overflow-x: auto;">
                <table id="savedDataTable">
                    <thead>
                        <tr>
                            <th>Sr. No.</th>
                            <th>Type of Concrete</th>
                            <th>Grade</th>
                            <th>Date and Time</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody id="savedDataBody">
                        <!-- Saved data will appear here -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- Display Saved Data Section -->
        <div id="displaySavedData" class="section" style="display: none;">
            <h2>Saved Mix Design Data</h2>
            <div id="savedDataContent">
                <!-- Saved data content will appear here -->
            </div>
            <div class="action-buttons">
                <button class="delete-btn" id="deleteSavedDataBtn">Delete This Data</button>
                <button class="print-btn" id="printSavedDataBtn">Download as PNG</button>
                <button class="previous-btn" onclick="toggleSavedData()">Back to Saved Data</button>
            </div>
        </div>
        
        <!-- AI Disclaimer -->
        <div class="ai-disclaimer">
            <p><strong>Disclaimer:</strong> This website is made using AI and may contain mistakes. Please verify all calculations with a qualified engineer before use in actual construction projects.</p>
        </div>
        
        <!-- Footer with Visitor Counter -->
        <div class="footer">
            <p>Thank you for using ConMix - Concrete Mix Design Proportioning Calculator</p>
            <div class="visitor-counter">
                Total Visitors: <span id="visitorCount">0</span>
            </div>
        </div>
    </div>

    <script>
        // Standard deviation values - Extended for high strength concrete
        const stdDeviation = {
            "M10": 3.5, "M15": 3.5,
            "M20": 4.0, "M25": 4.0,
            "M30": 5.0, "M35": 5.0, "M40": 5.0, "M45": 5.0, "M50": 5.0, "M55": 5.0, "M60": 5.0,
            "M65": 6.0, "M70": 6.0, "M75": 6.0, "M80": 6.0,
            "M85": 6.5, "M90": 6.5, "M95": 6.5, "M100": 6.5,
            "M105": 7.0, "M110": 7.0, "M115": 7.0, "M120": 7.0
        };

        // X factor values - Extended for high strength concrete
        const xFactor = {
            "M10": 5.0, "M15": 5.0,
            "M20": 5.5, "M25": 5.5,
            "M30": 6.5, "M35": 6.5, "M40": 6.5, "M45": 6.5, "M50": 6.5, "M55": 6.5, "M60": 6.5,
            "M65": 8.0, "M70": 8.0, "M75": 8.0, "M80": 8.0,
            "M85": 8.5, "M90": 8.5, "M95": 8.5, "M100": 8.5,
            "M105": 9.0, "M110": 9.0, "M115": 9.0, "M120": 9.0
        };

        // Water content values
        const waterContent = {
            "10": 208,
            "20": 186,
            "40": 165
        };

        // Coarse aggregate volume for w/c 0.50
        const caVolume = {
            "10": {"I": 0.48, "II": 0.50, "III": 0.52, "IV": 0.54},
            "20": {"I": 0.60, "II": 0.62, "III": 0.64, "IV": 0.66},
            "40": {"I": 0.69, "II": 0.71, "III": 0.72, "IV": 0.73}
        };

        // Exposure requirements
        const exposureRequirements = {
            "mild": { 
                plain: { minCement: 220, maxWCR: 0.60, minGrade: null }, 
                reinforced: { minCement: 300, maxWCR: 0.55, minGrade: "M20" } 
            },
            "moderate": { 
                plain: { minCement: 240, maxWCR: 0.60, minGrade: "M15" }, 
                reinforced: { minCement: 300, maxWCR: 0.50, minGrade: "M25" } 
            },
            "severe": { 
                plain: { minCement: 250, maxWCR: 0.50, minGrade: "M20" }, 
                reinforced: { minCement: 320, maxWCR: 0.45, minGrade: "M30" } 
            },
            "verySevere": { 
                plain: { minCement: 260, maxWCR: 0.45, minGrade: "M20" }, 
                reinforced: { minCement: 340, maxWCR: 0.45, minGrade: "M35" } 
            },
            "extreme": { 
                plain: { minCement: 280, maxWCR: 0.40, minGrade: "M25" }, 
                reinforced: { minCement: 360, maxWCR: 0.40, minGrade: "M25" } 
            }
        };

        // DOM Elements
        const googleLoginBtn = document.getElementById('googleLoginBtn');
        const googleLoginContainer = document.getElementById('googleLoginContainer');
        const userPanel = document.getElementById('userPanel');
        const userName = document.getElementById('userName');
        const userIcon = document.getElementById('userIcon');
        const logoutBtn = document.getElementById('logoutBtn');
        const previousDataBtn = document.getElementById('previousDataBtn');
        const gradeSelect = document.getElementById('grade');
        const targetStrengthPreview = document.getElementById('targetStrengthPreview');
        const deleteSavedDataBtn = document.getElementById('deleteSavedDataBtn');
        const cementTypeSelect = document.getElementById('cementType');
        const useFlyAshCheckbox = document.getElementById('useFlyAsh');
        const waterCementRatioInput = document.getElementById('waterCementRatio');
        const waterCementRatioLabel = document.getElementById('waterCementRatioLabel');
        const wcrRestrictionInfo = document.getElementById('wcrRestrictionInfo');
        const useFlyAshLabel = document.getElementById('useFlyAshLabel');
        const flyAshRestrictionNote = document.getElementById('flyAshRestrictionNote');
        const adjustmentMessage = document.getElementById('adjustmentMessage');
        const concreteTypeSelect = document.getElementById('concreteType');
        const steelFiberSection = document.getElementById('steelFiberSection');
        const useSteelFibersCheckbox = document.getElementById('useSteelFibers');
        const steelFiberPercentageInput = document.getElementById('steelFiberPercentage');
        const spGravitySteelFibersInput = document.getElementById('spGravitySteelFibers');
        const adjustmentsSection = document.getElementById('adjustmentsSection');
        const waterAdjustmentInput = document.getElementById('waterAdjustment');
        const cementAdjustmentInput = document.getElementById('cementAdjustment');
        const fineAggregateAdjustmentInput = document.getElementById('fineAggregateAdjustment');
        const coarseAggregateAdjustmentInput = document.getElementById('coarseAggregateAdjustment');
        const flyAshAdjustmentGroup = document.getElementById('flyAshAdjustmentGroup');
        const flyAshAdjustmentInput = document.getElementById('flyAshAdjustment');
        const gradeLabel = document.getElementById('gradeLabel');
        const autoSwitchMessage = document.getElementById('autoSwitchMessage');
        const steelFiberCalcSection = document.getElementById('steelFiberCalcSection');
        const flyAshSection = document.getElementById('flyAshSection');
        const calculateMixBtn = document.getElementById('calculateMixBtn');
        const printSavedDataBtn = document.getElementById('printSavedDataBtn');
        const visitorCountElement = document.getElementById('visitorCount');

        let materialChart;
        let savedMaterialChart;
        let currentData = null;
        let currentlyViewingDataIndex = null;

        // User management variables
        let currentUser = null;
        let users = [];

        // Visitor counter
        let visitorCount = 0;

        // Event Listeners
        googleLoginBtn.addEventListener('click', handleGoogleLogin);
        logoutBtn.addEventListener('click', logout);
        previousDataBtn.addEventListener('click', function() {
            toggleSavedData();
            document.getElementById('savedData').scrollIntoView({ behavior: 'smooth' });
        });
        
        // Event listener for delete saved data button
        deleteSavedDataBtn.addEventListener('click', deleteSavedData);
        
        // Event listener for print saved data button
        printSavedDataBtn.addEventListener('click', downloadSavedDataAsPNG);

        // Event listener for grade selection to show target strength preview
        gradeSelect.addEventListener('change', updateTargetStrengthPreview);

        // Event listener for cement type change
        cementTypeSelect.addEventListener('change', handleCementTypeChange);

        // Event listeners for exposure condition and concrete type changes
        document.getElementById('exposure').addEventListener('change', handleExposureChange);
        document.querySelectorAll('input[name="concreteType"]').forEach(radio => {
            radio.addEventListener('change', handleExposureChange);
        });

        // Event listener for concrete type selection
        concreteTypeSelect.addEventListener('change', handleConcreteTypeChange);

        // Event listener for steel fibers checkbox
        useSteelFibersCheckbox.addEventListener('change', handleSteelFibersChange);

        // Event listener for fly ash checkbox
        useFlyAshCheckbox.addEventListener('change', handleFlyAshChange);

        // Event listener for admixture checkbox
        document.getElementById('useAdmixture').addEventListener('change', handleAdmixtureChange);

        // Event listener for water-cement ratio input validation
        waterCementRatioInput.addEventListener('input', validateWaterCementRatio);

        // Event listener for calculate button
        calculateMixBtn.addEventListener('click', calculateMix);

        // Set up event listeners for checkboxes
        document.getElementById('useFlyAsh').addEventListener('change', function() {
            document.getElementById('flyAshPercentage').disabled = !this.checked;
            document.getElementById('spGravityFlyAsh').disabled = !this.checked;
        });

        document.getElementById('useAdmixture').addEventListener('change', function() {
            document.getElementById('admixturePercentage').disabled = !this.checked;
            document.getElementById('spGravityAdmixture').disabled = !this.checked;
            document.getElementById('waterReduction').disabled = !this.checked;
        });

        // Highlight exposure row based on selection
        document.getElementById('exposure').addEventListener('change', function() {
            highlightExposureCells();
        });

        // Update exposure requirements when concrete type changes
        document.querySelectorAll('input[name="concreteType"]').forEach(radio => {
            radio.addEventListener('change', function() {
                highlightExposureCells();
            });
        });

        // Google Login Handler (simulated)
        function handleGoogleLogin() {
            // In a real application, this would integrate with Google OAuth
            // For demo purposes, we'll simulate a login
            const simulatedUser = {
                name: "Google User",
                email: "user@gmail.com",
                picture: null
            };
            
            currentUser = {
                id: 'google_user',
                name: simulatedUser.name,
                email: simulatedUser.email,
                data: []
            };
            
            // Save to localStorage
            localStorage.setItem('currentConmixUser', JSON.stringify(currentUser));
            showUserPanel(currentUser);
            
            // Show success message
            showMessage("Successfully logged in with Google!", "success");
        }

        // Check if user is already logged in
        function checkUserLogin() {
            const savedCurrentUser = localStorage.getItem('currentConmixUser');
            if (savedCurrentUser) {
                currentUser = JSON.parse(savedCurrentUser);
                showUserPanel(currentUser);
            }
            
            // Load visitor count
            loadVisitorCount();
        }

        function showUserPanel(user) {
            googleLoginContainer.style.display = 'none';
            userPanel.style.display = 'flex';
            userName.textContent = user.name;
            userIcon.textContent = user.name.charAt(0).toUpperCase();
        }

        function logout() {
            currentUser = null;
            localStorage.removeItem('currentConmixUser');
            googleLoginContainer.style.display = 'block';
            userPanel.style.display = 'none';
            
            // Hide saved data if they're visible
            document.getElementById('savedData').style.display = 'none';
            document.getElementById('displaySavedData').style.display = 'none';
            
            // Show message
            showMessage("Successfully logged out!", "success");
        }

        function highlightExposureCells() {
            // Remove highlight from all cells
            document.querySelectorAll('#exposureTable td').forEach(cell => {
                cell.classList.remove('highlight-cell');
            });
            
            // Remove highlight from all rows
            document.querySelectorAll('#exposureTable tr').forEach(row => {
                row.classList.remove('highlight-row');
            });
            
            const exposure = document.getElementById('exposure').value;
            const concreteType = getConcreteType();
            
            // Add highlight to selected row
            document.getElementById(exposure + 'Row').classList.add('highlight-row');
            
            // Add highlight to the appropriate cells based on concrete type
            if (concreteType === 'plain') {
                document.getElementById(exposure + 'PlainCement').classList.add('highlight-cell');
                document.getElementById(exposure + 'PlainWCR').classList.add('highlight-cell');
                document.getElementById(exposure + 'PlainGrade').classList.add('highlight-cell');
            } else {
                document.getElementById(exposure + 'ReinforcedCement').classList.add('highlight-cell');
                document.getElementById(exposure + 'ReinforcedWCR').classList.add('highlight-cell');
                document.getElementById(exposure + 'ReinforcedGrade').classList.add('highlight-cell');
            }
        }

        function getConcreteType() {
            return document.querySelector('input[name="concreteType"]:checked').value;
        }

        function showMessage(message, type) {
            const messageArea = document.getElementById('messageArea');
            messageArea.innerHTML = `<div class="message ${type}">${message}</div>`;
            
            // Auto-hide success messages after 3 seconds
            if (type === 'success') {
                setTimeout(() => {
                    messageArea.innerHTML = '';
                }, 3000);
            }
        }

        // Update target strength preview when grade changes
        function updateTargetStrengthPreview() {
            const gradeValue = parseInt(gradeSelect.value);
            
            // Automatically set concrete type based on grade
            let concreteType;
            if (gradeValue <= 50) {
                concreteType = 'conventional';
            } else {
                concreteType = 'highStrength';
            }
            
            // Update concrete type dropdown if different
            if (concreteTypeSelect.value !== concreteType) {
                concreteTypeSelect.value = concreteType;
                handleConcreteTypeChange();
                
                // Show auto-switch message
                autoSwitchMessage.innerHTML = `<strong>Auto-switch applied:</strong> Concrete type changed to ${concreteType === 'highStrength' ? 'High Strength Concrete' : 'Conventional Concrete'} based on grade M${gradeValue}.`;
                autoSwitchMessage.style.display = 'block';
                
                // Hide the message after 5 seconds
                setTimeout(() => {
                    autoSwitchMessage.style.display = 'none';
                }, 5000);
            }
            
            // Calculate target strength
            const fck = gradeValue;
            const gradeKey = `M${gradeValue}`;
            const S = stdDeviation[gradeKey] || 5.0; // Default to 5.0 if not found
            const X = xFactor[gradeKey] || 6.5; // Default to 6.5 if not found
            
            const fck1 = fck + 1.65 * S;
            const fck2 = fck + X;
            const targetStrength = Math.max(fck1, fck2);
            
            // Display target strength preview
            targetStrengthPreview.style.display = 'block';
            targetStrengthPreview.innerHTML = `
                Target Mean Strength: ${targetStrength.toFixed(2)} N/mm²
            `;
            
            // Update WCR restrictions based on exposure
            updateWCRRestrictions();
        }

        // Handle cement type change
        function handleCementTypeChange() {
            const isPPC = cementTypeSelect.value === 'PPC';
            
            // If PPC is selected, hide the entire fly ash section
            if (isPPC) {
                flyAshSection.style.display = 'none';
            } else {
                flyAshSection.style.display = 'block';
                useFlyAshCheckbox.disabled = false;
                document.getElementById('flyAshPercentage').disabled = !useFlyAshCheckbox.checked;
                document.getElementById('spGravityFlyAsh').disabled = !useFlyAshCheckbox.checked;
            }
        }

        // Handle exposure condition change
        function handleExposureChange() {
            updateWCRRestrictions();
            
            // Update highlight for exposure table
            highlightExposureCells();
        }

        // Update WCR restrictions based on exposure conditions
        function updateWCRRestrictions() {
            const exposure = document.getElementById('exposure').value;
            const concreteType = getConcreteType();
            const expReq = exposureRequirements[exposure][concreteType];
            const maxWCR = expReq.maxWCR;
            const currentWCR = parseFloat(waterCementRatioInput.value);
            
            // Update WCR restriction info
            let warningHTML = '';
            if (currentWCR > maxWCR) {
                warningHTML = `<div class="warning-message">
                    <p><strong>Warning:</strong> The entered water-cement ratio (${currentWCR}) exceeds the maximum recommended (${maxWCR}) for ${exposure} exposure condition.</p>
                    <p>This may affect the durability of the concrete. Consider using a lower water-cement ratio.</p>
                </div>`;
            }
            
            wcrRestrictionInfo.innerHTML = `
                <p><strong>Recommended maximum W/C ratio for ${exposure} exposure: ${maxWCR}</strong></p>
                <p>Concrete type: ${concreteType === 'plain' ? 'Plain Concrete' : 'Reinforced Concrete'}</p>
                ${warningHTML}
            `;
            wcrRestrictionInfo.style.display = 'block';
        }

        // Validate water-cement ratio
        function validateWaterCementRatio() {
            const exposure = document.getElementById('exposure').value;
            const concreteType = getConcreteType();
            const expReq = exposureRequirements[exposure][concreteType];
            const maxWCR = expReq.maxWCR;
            const currentWCR = parseFloat(waterCementRatioInput.value);
            const validationMessage = document.getElementById('waterCementRatioValidation');
            
            if (currentWCR > maxWCR) {
                waterCementRatioInput.classList.add('input-invalid');
                waterCementRatioInput.classList.remove('input-valid');
                validationMessage.textContent = `Warning: W/C ratio exceeds maximum recommended value of ${maxWCR} for ${exposure} exposure`;
                validationMessage.classList.add('invalid');
                validationMessage.classList.remove('valid');
            } else {
                waterCementRatioInput.classList.add('input-valid');
                waterCementRatioInput.classList.remove('input-invalid');
                validationMessage.textContent = `Valid: W/C ratio is within recommended range`;
                validationMessage.classList.add('valid');
                validationMessage.classList.remove('invalid');
            }
            
            // Update WCR restrictions
            updateWCRRestrictions();
        }

        // Get current grade value as a number
        function getCurrentGradeValue() {
            return parseInt(gradeSelect.value);
        }

        // Handle concrete type change
        function handleConcreteTypeChange() {
            const isHighStrength = concreteTypeSelect.value === 'highStrength';
            
            if (isHighStrength) {
                // Show steel fiber section
                steelFiberSection.classList.remove('hidden-section');
                
                // Update grade selection if needed
                const currentGrade = getCurrentGradeValue();
                if (currentGrade <= 50) {
                    gradeSelect.value = '55';
                    updateTargetStrengthPreview();
                }
            } else {
                // Hide steel fiber section and adjustments
                steelFiberSection.classList.add('hidden-section');
                adjustmentsSection.classList.add('hidden-section');
                
                // Reset steel fibers checkbox
                useSteelFibersCheckbox.checked = false;
                steelFiberPercentageInput.disabled = true;
                spGravitySteelFibersInput.disabled = true;
                
                // Update grade selection if needed
                const currentGrade = getCurrentGradeValue();
                if (currentGrade > 50) {
                    gradeSelect.value = '50';
                    updateTargetStrengthPreview();
                }
            }
            
            // Update WCR restrictions
            updateWCRRestrictions();
        }

        // Handle steel fibers change
        function handleSteelFibersChange() {
            const useSteelFibers = useSteelFibersCheckbox.checked;
            
            if (useSteelFibers) {
                // Enable steel fiber inputs
                steelFiberPercentageInput.disabled = false;
                spGravitySteelFibersInput.disabled = false;
                
                // Show adjustments section
                adjustmentsSection.classList.remove('hidden-section');
                
                // Update water adjustment based on admixture
                handleAdmixtureChange();
                
                // Update fly ash adjustment based on fly ash selection
                handleFlyAshChange();
            } else {
                // Disable steel fiber inputs
                steelFiberPercentageInput.disabled = true;
                spGravitySteelFibersInput.disabled = true;
                
                // Hide adjustments section
                adjustmentsSection.classList.add('hidden-section');
                
                // Reset adjustment values
                waterAdjustmentInput.value = 0;
                cementAdjustmentInput.value = 0;
                fineAggregateAdjustmentInput.value = 0;
                coarseAggregateAdjustmentInput.value = 0;
                flyAshAdjustmentInput.value = 0;
            }
        }

        // Handle fly ash change
        function handleFlyAshChange() {
            const useFlyAsh = useFlyAshCheckbox.checked;
            
            // Update fly ash inputs enabled state
            document.getElementById('flyAshPercentage').disabled = !useFlyAsh;
            document.getElementById('spGravityFlyAsh').disabled = !useFlyAsh;
            
            if (useFlyAsh && useSteelFibersCheckbox.checked) {
                // Show fly ash adjustment
                flyAshAdjustmentGroup.classList.remove('hidden-section');
            } else {
                // Hide fly ash adjustment
                flyAshAdjustmentGroup.classList.add('hidden-section');
                flyAshAdjustmentInput.value = 0;
            }
        }

        // Handle admixture change
        function handleAdmixtureChange() {
            const useAdmixture = document.getElementById('useAdmixture').checked;
            
            if (useAdmixture && useSteelFibersCheckbox.checked) {
                // Disable water adjustment if admixture is used
                waterAdjustmentInput.disabled = true;
                waterAdjustmentInput.value = 0;
                waterAdjustmentInput.title = "Water adjustment is disabled when admixture is used";
            } else if (useSteelFibersCheckbox.checked) {
                // Enable water adjustment if admixture is not used
                waterAdjustmentInput.disabled = false;
                waterAdjustmentInput.title = "";
            }
        }

        function calculateMix() {
            // Get input values
            const gradeValue = parseInt(gradeSelect.value);
            const aggSize = document.getElementById('aggSize').value;
            const zone = document.getElementById('zone').value;
            const slump = parseFloat(document.getElementById('slump').value);
            const exposure = document.getElementById('exposure').value;
            const spGravityCement = parseFloat(document.getElementById('spGravityCement').value);
            const spGravityFA = parseFloat(document.getElementById('spGravityFA').value);
            const spGravityCA = parseFloat(document.getElementById('spGravityCA').value);
            const absorptionFA = parseFloat(document.getElementById('absorptionFA').value);
            const absorptionCA = parseFloat(document.getElementById('absorptionCA').value);
            const useFlyAsh = document.getElementById('useFlyAsh').checked;
            const flyAshPercentage = useFlyAsh ? parseFloat(document.getElementById('flyAshPercentage').value) : 0;
            const spGravityFlyAsh = useFlyAsh ? parseFloat(document.getElementById('spGravityFlyAsh').value) : 0;
            const useAdmixture = document.getElementById('useAdmixture').checked;
            const admixturePercentage = useAdmixture ? parseFloat(document.getElementById('admixturePercentage').value) : 0;
            const spGravityAdmixture = useAdmixture ? parseFloat(document.getElementById('spGravityAdmixture').value) : 0;
            const waterReduction = useAdmixture ? parseFloat(document.getElementById('waterReduction').value) : 0;
            const selectedWCR = parseFloat(document.getElementById('waterCementRatio').value);
            const useSteelFibers = document.getElementById('useSteelFibers').checked;
            const steelFiberPercentage = useSteelFibers ? parseFloat(document.getElementById('steelFiberPercentage').value) : 0;
            const spGravitySteelFibers = useSteelFibers ? parseFloat(document.getElementById('spGravitySteelFibers').value) : 7.85;
            const waterAdjustment = useSteelFibers ? parseFloat(document.getElementById('waterAdjustment').value) : 0;
            const cementAdjustment = useSteelFibers ? parseFloat(document.getElementById('cementAdjustment').value) : 0;
            const fineAggregateAdjustment = useSteelFibers ? parseFloat(document.getElementById('fineAggregateAdjustment').value) : 0;
            const coarseAggregateAdjustment = useSteelFibers ? parseFloat(document.getElementById('coarseAggregateAdjustment').value) : 0;
            const flyAshAdjustment = (useSteelFibers && useFlyAsh) ? parseFloat(document.getElementById('flyAshAdjustment').value) : 0;

            // Format grade for display (M30)
            const formattedGrade = `M${gradeValue}`;
            
            // Get exposure requirements for checking
            const concreteStructureType = getConcreteType();
            const expReq = exposureRequirements[exposure][concreteStructureType];
            const maxAllowedWCR = expReq.maxWCR;
            
            // Calculate target strength
            const fck = gradeValue;
            const gradeKey = `M${gradeValue}`;
            const S = stdDeviation[gradeKey] || 5.0; // Default to 5.0 if not found
            const X = xFactor[gradeKey] || 6.5; // Default to 6.5 if not found
            
            const fck1 = fck + 1.65 * S;
            const fck2 = fck + X;
            const targetStrength = Math.max(fck1, fck2);
            
            document.getElementById('targetStrengthCalc').innerHTML = `
                <p>Grade of Concrete: <span class="highlight">${formattedGrade}</span></p>
                <p>Characteristic compressive strength, f<sub>ck</sub> = ${fck} N/mm²</p>
                <p>Standard deviation, S = ${S} N/mm²</p>
                <p>Factor X = ${X} N/mm²</p>
                <p>f<sub>ck</sub> + 1.65 × S = ${fck} + 1.65 × ${S} = <span class="highlight">${fck1.toFixed(2)} N/mm²</span></p>
                <p>f<sub>ck</sub> + X = ${fck} + ${X} = <span class="highlight">${fck2.toFixed(2)} N/mm²</span></p>
                <p><strong>Target average compressive strength, f'<sub>ck</sub> = ${targetStrength.toFixed(2)} N/mm²</strong></p>
            `;

            // Highlight exposure cells
            highlightExposureCells();

            // Calculate air content
            const airContent = aggSize === "10" ? 1.5 : (aggSize === "20" ? 1.0 : 0.8);
            document.getElementById('airContent').innerHTML = `
                <p>For nominal maximum aggregate size of ${aggSize} mm, entrapped air = <span class="highlight">${airContent}%</span></p>
                <p>Volume of entrapped air = ${airContent/100} m³</p>
            `;

            // Calculate water content
            let baseWaterContent = waterContent[aggSize];
            let adjustedWaterContent = baseWaterContent;
            
            // Adjust for slump
            if (slump !== 50) {
                const slumpAdjustment = ((slump - 50) / 25) * 0.03 * baseWaterContent;
                adjustedWaterContent += slumpAdjustment;
            }
            
            // Apply admixture reduction if used
            if (useAdmixture) {
                adjustedWaterContent *= (1 - waterReduction/100);
            }
            
            // Check water content limit (450 kg/m³)
            if (adjustedWaterContent > 450) {
                adjustedWaterContent = 450;
                document.getElementById('waterContentCalc').innerHTML += `
                    <p class="highlight">Water content limited to 450 kg/m³ as per IS 456</p>
                `;
            }
            
            document.getElementById('waterContentCalc').innerHTML = `
                <p>Base water content for ${aggSize} mm aggregate = <span class="highlight">${baseWaterContent} kg/m³</span></p>
                ${slump !== 50 ? 
                    `<p>Adjustment for ${slump} mm slump: ${((slump - 50) / 25) * 3}% = ${(((slump - 50) / 25) * 0.03 * baseWaterContent).toFixed(2)} kg/m³</p>` : 
                    ''}
                ${useAdmixture ? `<p>Reduction due to admixture: ${waterReduction}%</p>` : ''}
                <p><strong>Final water content = <span class="highlight">${adjustedWaterContent.toFixed(2)} kg/m³</span></strong></p>
            `;

            // Calculate cement content
            let cementContent = adjustedWaterContent / selectedWCR;
            
            // Adjust for fly ash if used
            let flyAshContent = 0;
            let cementitiousContent = cementContent;
            
            if (useFlyAsh) {
                flyAshContent = cementitiousContent * (flyAshPercentage / 100);
                cementContent = cementitiousContent - flyAshContent;
            }
            
            document.getElementById('cementContentCalc').innerHTML = `
                <p>Cementitious content = Water content / Water-cement ratio</p>
                <p>= ${adjustedWaterContent.toFixed(2)} / ${selectedWCR.toFixed(3)}</p>
                <p>= <span class="highlight">${cementitiousContent.toFixed(2)} kg/m³</span></p>
                ${useFlyAsh ? `
                <p>Fly ash content = ${cementitiousContent.toFixed(2)} × ${flyAshPercentage}% = <span class="highlight">${flyAshContent.toFixed(2)} kg/m³</span></p>
                <p>Cement content = ${cementitiousContent.toFixed(2)} - ${flyAshContent.toFixed(2)} = <span class="highlight">${cementContent.toFixed(2)} kg/m³</span></p>
                ` : `
                <p>Cement content = <span class="highlight">${cementContent.toFixed(2)} kg/m³</span></p>
                `}
            `;
            
            // Check against exposure requirements
            let cementContentAdjusted = cementContent;
            if (cementContent < expReq.minCement) {
                cementContentAdjusted = expReq.minCement;
                // Recalculate fly ash if used
                if (useFlyAsh) {
                    flyAshContent = cementContentAdjusted * (flyAshPercentage / (100 - flyAshPercentage));
                    cementitiousContent = cementContentAdjusted + flyAshContent;
                } else {
                    cementitiousContent = cementContentAdjusted;
                }
                
                // Recalculate water content if cement content was adjusted
                adjustedWaterContent = cementitiousContent * selectedWCR;
            }
            
            // Create exposure check message
            let exposureCheckHTML = `
                <p>Exposure condition: ${exposure.charAt(0).toUpperCase() + exposure.slice(1)}</p>
                <p>Concrete type: ${concreteStructureType === 'plain' ? 'Plain Concrete' : 'Reinforced Concrete'}</p>
                <p>Minimum cement content required: ${expReq.minCement} kg/m³</p>
                <p>Maximum water-cement ratio recommended: ${expReq.maxWCR}</p>
                <p>Minimum grade required: ${expReq.minGrade || '--'}</p>
            `;
            
            if (cementContent < expReq.minCement) {
                exposureCheckHTML += `<p class="highlight">Cement content increased to meet exposure requirement: ${cementContentAdjusted.toFixed(2)} kg/m³</p>`;
            } else {
                exposureCheckHTML += `<p>Calculated cement content meets exposure requirement</p>`;
            }
            
            // Add warning if W/C ratio exceeds maximum
            if (selectedWCR > maxAllowedWCR) {
                exposureCheckHTML += `
                    <div class="warning-message">
                        <p><strong>Warning:</strong> The entered water-cement ratio (${selectedWCR}) exceeds the maximum recommended (${maxAllowedWCR}) for ${exposure} exposure condition.</p>
                        <p>This may affect the durability of the concrete. Consider using a lower water-cement ratio.</p>
                    </div>
                `;
            }
            
            document.getElementById('exposureCheck').innerHTML = exposureCheckHTML;

            // Calculate aggregate proportions
            const baseCAVolume = caVolume[aggSize][zone];
            let adjustedCAVolume = baseCAVolume;
            
            // Adjust for water-cement ratio
            if (selectedWCR < 0.5) {
                const adjustment = ((0.5 - selectedWCR) / 0.05) * 0.01;
                adjustedCAVolume += adjustment;
            } else if (selectedWCR > 0.5) {
                const adjustment = ((selectedWCR - 0.5) / 0.05) * 0.01;
                adjustedCAVolume -= adjustment;
            }
            
            const faVolume = 1 - adjustedCAVolume;
            
            document.getElementById('aggregateProportion').innerHTML = `
                <p>Base volume of coarse aggregate for ${aggSize} mm aggregate, Zone ${zone}, w/c 0.50 = <span class="highlight">${baseCAVolume} m³</span></p>
                <p>Adjustment for w/c ${selectedWCR.toFixed(3)}: ${((0.5 - selectedWCR) / 0.05) * 0.01} m³</p>
                <p>Adjusted volume of coarse aggregate = <span class="highlight">${adjustedCAVolume.toFixed(3)} m³</span></p>
                <p>Volume of fine aggregate = 1 - ${adjustedCAVolume.toFixed(3)} = <span class="highlight">${faVolume.toFixed(3)} m³</span></p>
            `;

            // Perform mix calculations
            const volumeCement = cementContentAdjusted / (spGravityCement * 1000);
            const volumeFlyAsh = useFlyAsh ? flyAshContent / (spGravityFlyAsh * 1000) : 0;
            const volumeWater = adjustedWaterContent / 1000; // Specific gravity of water is 1
            const volumeAir = airContent / 100;
            
            // Calculate admixture volume if used
            const admixtureDosage = useAdmixture ? cementitiousContent * (admixturePercentage / 100) : 0;
            const volumeAdmixture = useAdmixture ? admixtureDosage / (spGravityAdmixture * 1000) : 0;
            
            // Calculate steel fiber volume and mass if used
            const steelFiberVolume = useSteelFibers ? steelFiberPercentage / 100 : 0;
            const steelFiberMass = useSteelFibers ? steelFiberVolume * spGravitySteelFibers * 1000 : 0;
            
            // Show steel fiber calculation if used
            if (useSteelFibers) {
                steelFiberCalcSection.classList.remove('hidden-section');
                document.getElementById('steelFiberCalc').innerHTML = `
                    <p>Steel Fiber Percentage: ${steelFiberPercentage}%</p>
                    <p>Specific Gravity of Steel Fibers: ${spGravitySteelFibers}</p>
                    <p>Volume of Steel Fibers = ${steelFiberPercentage}% = ${steelFiberVolume.toFixed(4)} m³</p>
                    <p>Mass of Steel Fibers = Volume × Specific Gravity × 1000</p>
                    <p>= ${steelFiberVolume.toFixed(4)} × ${spGravitySteelFibers} × 1000</p>
                    <p>= <span class="highlight">${steelFiberMass.toFixed(2)} kg</span></p>
                `;
            } else {
                steelFiberCalcSection.classList.add('hidden-section');
            }
            
            const volumeAllAggregate = 1 - volumeAir - volumeCement - volumeFlyAsh - volumeWater - volumeAdmixture - steelFiberVolume;
            
            const massCA = volumeAllAggregate * adjustedCAVolume * spGravityCA * 1000;
            const massFA = volumeAllAggregate * faVolume * spGravityFA * 1000;
            
            // Apply adjustments for high strength concrete with steel fibers
            let adjustedWater = adjustedWaterContent;
            let adjustedCement = cementContentAdjusted;
            let adjustedFlyAsh = flyAshContent;
            let adjustedFA = massFA;
            let adjustedCA = massCA;
            
            if (useSteelFibers) {
                // Apply adjustments
                adjustedWater += adjustedWater * (waterAdjustment / 100);
                adjustedCement += adjustedCement * (cementAdjustment / 100);
                adjustedFA -= adjustedFA * (fineAggregateAdjustment / 100);
                adjustedCA -= adjustedCA * (coarseAggregateAdjustment / 100);
                
                if (useFlyAsh) {
                    adjustedFlyAsh -= adjustedFlyAsh * (flyAshAdjustment / 100);
                }
                
                // Recalculate volumes with adjustments
                const adjustedVolumeCement = adjustedCement / (spGravityCement * 1000);
                const adjustedVolumeFlyAsh = useFlyAsh ? adjustedFlyAsh / (spGravityFlyAsh * 1000) : 0;
                const adjustedVolumeWater = adjustedWater / 1000;
                
                // Recalculate aggregate volumes to maintain total volume of 1 m³
                const adjustedVolumeAllAggregate = 1 - volumeAir - adjustedVolumeCement - adjustedVolumeFlyAsh - adjustedVolumeWater - volumeAdmixture - steelFiberVolume;
                
                adjustedFA = adjustedVolumeAllAggregate * faVolume * spGravityFA * 1000;
                adjustedCA = adjustedVolumeAllAggregate * adjustedCAVolume * spGravityCA * 1000;
            }
            
            document.getElementById('mixCalculations').innerHTML = `
                <p>a) Total volume = 1 m³</p>
                <p>b) Volume of entrapped air = ${volumeAir.toFixed(3)} m³</p>
                <p>c) Volume of cement = ${cementContentAdjusted.toFixed(2)} / (${spGravityCement} × 1000) = ${volumeCement.toFixed(4)} m³</p>
                ${useFlyAsh ? `<p>d) Volume of fly ash = ${flyAshContent.toFixed(2)} / (${spGravityFlyAsh} × 1000) = ${volumeFlyAsh.toFixed(4)} m³</p>` : ''}
                <p>${useFlyAsh ? 'e' : 'd'}) Volume of water = ${adjustedWaterContent.toFixed(2)} / 1000 = ${volumeWater.toFixed(4)} m³</p>
                ${useAdmixture ? `<p>${useFlyAsh ? 'f' : 'e'}) Volume of admixture = ${admixtureDosage.toFixed(2)} / (${spGravityAdmixture} × 1000) = ${volumeAdmixture.toFixed(4)} m³</p>` : ''}
                ${useSteelFibers ? `<p>${useFlyAsh && useAdmixture ? 'g' : (useFlyAsh || useAdmixture) ? 'f' : 'e'}) Volume of steel fibers = ${steelFiberPercentage}% = ${steelFiberVolume.toFixed(4)} m³</p>` : ''}
                <p>${useSteelFibers ? (useFlyAsh && useAdmixture ? 'h' : (useFlyAsh || useAdmixture) ? 'g' : 'f') : (useFlyAsh && useAdmixture ? 'g' : (useFlyAsh || useAdmixture) ? 'f' : 'e')}) Volume of all aggregate = [1 - ${volumeAir.toFixed(3)} - ${volumeCement.toFixed(4)}${useFlyAsh ? ` - ${volumeFlyAsh.toFixed(4)}` : ''} - ${volumeWater.toFixed(4)}${useAdmixture ? ` - ${volumeAdmixture.toFixed(4)}` : ''}${useSteelFibers ? ` - ${steelFiberVolume.toFixed(4)}` : ''}] = ${volumeAllAggregate.toFixed(4)} m³</p>
                <p>${useSteelFibers ? (useFlyAsh && useAdmixture ? 'i' : (useFlyAsh || useAdmixture) ? 'h' : 'g') : (useFlyAsh && useAdmixture ? 'h' : (useFlyAsh || useAdmixture) ? 'g' : 'f')}) Mass of coarse aggregate = ${volumeAllAggregate.toFixed(4)} × ${adjustedCAVolume.toFixed(3)} × ${spGravityCA} × 1000 = <span class="highlight">${massCA.toFixed(2)} kg</span></p>
                <p>${useSteelFibers ? (useFlyAsh && useAdmixture ? 'j' : (useFlyAsh || useAdmixture) ? 'i' : 'h') : (useFlyAsh && useAdmixture ? 'i' : (useFlyAsh || useAdmixture) ? 'h' : 'g')}) Mass of fine aggregate = ${volumeAllAggregate.toFixed(4)} × ${faVolume.toFixed(3)} × ${spGravityFA} × 1000 = <span class="highlight">${massFA.toFixed(2)} kg</span></p>
                ${useSteelFibers ? `
                <div class="adjustment-message">
                    <p><strong>Adjustments applied for high strength concrete with steel fibers:</strong></p>
                    <p>Water: +${waterAdjustment}% (${adjustedWater.toFixed(2)} kg)</p>
                    <p>Cement: +${cementAdjustment}% (${adjustedCement.toFixed(2)} kg)</p>
                    <p>Fine Aggregate: -${fineAggregateAdjustment}% (${adjustedFA.toFixed(2)} kg)</p>
                    <p>Coarse Aggregate: -${coarseAggregateAdjustment}% (${adjustedCA.toFixed(2)} kg)</p>
                    ${useFlyAsh ? `<p>Fly Ash: -${flyAshAdjustment}% (${adjustedFlyAsh.toFixed(2)} kg)</p>` : ''}
                </div>
                ` : ''}
            `;

            // Calculate adjustments for dry aggregates
            const massFADry = adjustedFA / (1 + absorptionFA/100);
            const massCADry = adjustedCA / (1 + absorptionCA/100);
            
            const extraWaterFA = adjustedFA - massFADry;
            const extraWaterCA = adjustedCA - massCADry;
            const totalExtraWater = extraWaterFA + extraWaterCA;
            
            // Store current data for saving
            currentData = {
                id: Date.now(), // Unique ID for the data
                grade: formattedGrade,
                concreteType: concreteTypeSelect.value,
                timestamp: new Date().toLocaleString(),
                cement: adjustedCement,
                flyAsh: adjustedFlyAsh,
                water: adjustedWater,
                fineAggregate: adjustedFA,
                coarseAggregate: adjustedCA,
                admixture: admixtureDosage,
                steelFibers: useSteelFibers ? steelFiberMass : 0,
                useFlyAsh: useFlyAsh,
                useAdmixture: useAdmixture,
                useSteelFibers: useSteelFibers,
                targetStrength: targetStrength.toFixed(2),
                wcr: selectedWCR.toFixed(3),
                exposure: exposure,
                concreteStructureType: concreteStructureType,
                // Save input parameters for later display
                inputParameters: {
                    gradeValue: gradeValue,
                    aggSize: aggSize,
                    zone: zone,
                    slump: slump,
                    spGravityCement: spGravityCement,
                    spGravityFA: spGravityFA,
                    spGravityCA: spGravityCA,
                    absorptionFA: absorptionFA,
                    absorptionCA: absorptionCA,
                    flyAshPercentage: flyAshPercentage,
                    spGravityFlyAsh: spGravityFlyAsh,
                    admixturePercentage: admixturePercentage,
                    spGravityAdmixture: spGravityAdmixture,
                    waterReduction: waterReduction,
                    steelFiberPercentage: steelFiberPercentage,
                    spGravitySteelFibers: spGravitySteelFibers
                },
                // Save chart data
                chartData: {
                    cement: adjustedCement,
                    flyAsh: adjustedFlyAsh,
                    water: adjustedWater,
                    fineAggregate: adjustedFA,
                    coarseAggregate: adjustedCA,
                    admixture: admixtureDosage,
                    steelFibers: useSteelFibers ? steelFiberMass : 0
                }
            };
            
            // Display final proportions
            document.getElementById('finalProportions').innerHTML = `
                <h3>Mix Proportions (per m³ of Concrete)</h3>
                <div style="overflow-x: auto;">
                    <table>
                        <tr>
                            <th>Material</th>
                            <th>Quantity (kg)</th>
                            <th>Ratio (by weight)</th>
                        </tr>
                        <tr>
                            <td>Cement</td>
                            <td>${adjustedCement.toFixed(2)}</td>
                            <td>1</td>
                        </tr>
                        ${useFlyAsh ? `
                        <tr>
                            <td>Fly Ash</td>
                            <td>${adjustedFlyAsh.toFixed(2)}</td>
                            <td>${(adjustedFlyAsh / adjustedCement).toFixed(3)}</td>
                        </tr>
                        ` : ''}
                        <tr>
                            <td>Water</td>
                            <td>${adjustedWater.toFixed(2)}</td>
                            <td>${(adjustedWater / adjustedCement).toFixed(3)}</td>
                        </tr>
                        <tr>
                            <td>Fine Aggregate</td>
                            <td>${adjustedFA.toFixed(2)}</td>
                            <td>${(adjustedFA / adjustedCement).toFixed(3)}</td>
                        </tr>
                        <tr>
                            <td>Coarse Aggregate</td>
                            <td>${adjustedCA.toFixed(2)}</td>
                            <td>${(adjustedCA / adjustedCement).toFixed(3)}</td>
                        </tr>
                        ${useAdmixture ? `
                        <tr>
                            <td>Admixture</td>
                            <td>${admixtureDosage.toFixed(2)}</td>
                            <td>${(admixtureDosage / adjustedCement).toFixed(3)}</td>
                        </tr>
                        ` : ''}
                        ${useSteelFibers ? `
                        <tr>
                            <td>Steel Fibers</td>
                            <td>${steelFiberMass.toFixed(2)}</td>
                            <td>${(steelFiberMass / adjustedCement).toFixed(3)}</td>
                        </tr>
                        ` : ''}
                    </table>
                </div>
                
                <h3>For Dry Aggregates</h3>
                <p>If aggregates are in dry condition:</p>
                <ul>
                    <li>Fine Aggregate (dry) = ${massFADry.toFixed(2)} kg</li>
                    <li>Coarse Aggregate (dry) = ${massCADry.toFixed(2)} kg</li>
                    <li>Extra water to be added = ${totalExtraWater.toFixed(2)} kg</li>
                </ul>
                
                <p><strong>Final Water Content (with dry aggregates) = ${(adjustedWater + totalExtraWater).toFixed(2)} kg</strong></p>
            `;

            // Create material quantities pie chart
            createMaterialChart(
                adjustedCement,
                adjustedFlyAsh,
                adjustedWater,
                adjustedFA,
                adjustedCA,
                admixtureDosage,
                useSteelFibers ? steelFiberMass : 0
            );

            // Show results section
            document.getElementById('results').style.display = 'block';
            
            // Clear any previous messages
            document.getElementById('messageArea').innerHTML = '';
        }

        function createMaterialChart(cement, flyAsh, water, fineAgg, coarseAgg, admixture, steelFibers = 0) {
            const ctx = document.getElementById('materialChart').getContext('2d');
            
            // Destroy previous chart if exists
            if (materialChart) {
                materialChart.destroy();
            }
            
            // Prepare data for the chart
            const materials = [
                { name: 'Cement', value: cement, color: 'rgb(54, 162, 235)' },
                { name: 'Fly Ash', value: flyAsh, color: 'rgb(153, 102, 255)' },
                { name: 'Water', value: water, color: 'rgb(75, 192, 192)' },
                { name: 'Fine Aggregate', value: fineAgg, color: 'rgb(255, 159, 64)' },
                { name: 'Coarse Aggregate', value: coarseAgg, color: 'rgb(255, 99, 132)' },
                { name: 'Admixture', value: admixture, color: 'rgb(201, 203, 207)' },
                { name: 'Steel Fibers', value: steelFibers, color: 'rgb(128, 128, 128)' }
            ];
            
            // Filter out materials with zero value
            const filteredMaterials = materials.filter(material => material.value > 0);
            
            // Calculate total for percentages
            const total = filteredMaterials.reduce((sum, material) => sum + material.value, 0);
            
            materialChart = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: filteredMaterials.map(material => `${material.name} (${((material.value / total) * 100).toFixed(1)}%)`),
                    datasets: [{
                        data: filteredMaterials.map(material => material.value),
                        backgroundColor: filteredMaterials.map(material => material.color),
                        borderColor: 'white',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: {
                                font: {
                                    size: 14,
                                    family: "'Times New Roman', serif"
                                },
                                padding: 20
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.parsed;
                                    const percentage = ((value / total) * 100).toFixed(1);
                                    return `${label.split(' (')[0]}: ${value.toFixed(2)} kg (${percentage}%)`;
                                }
                            }
                        },
                        title: {
                            display: true,
                            text: 'Material Quantities per m³ of Concrete',
                            font: {
                                size: 16,
                                family: "'Times New Roman', serif"
                            }
                        }
                    }
                }
            });
        }

        // Load visitor count from localStorage
        function loadVisitorCount() {
            const savedVisitorCount = localStorage.getItem('conmixVisitorCount');
            if (savedVisitorCount) {
                visitorCount = parseInt(savedVisitorCount);
            } else {
                visitorCount = 0;
            }
            
            // Increment visitor count
            visitorCount++;
            localStorage.setItem('conmixVisitorCount', visitorCount.toString());
            
            // Update display
            visitorCountElement.textContent = visitorCount;
        }

        function saveData() {
            if (!currentData) {
                showMessage("No data to save. Please calculate mix proportions first.", "error");
                return;
            }
            
            if (!currentUser) {
                showMessage("Please login to save data.", "error");
                return;
            }
            
            // Check if this data is already saved (by comparing key parameters)
            const existingDataIndex = currentUser.data.findIndex(data => 
                data.grade === currentData.grade &&
                Math.abs(data.wcr - currentData.wcr) < 0.001 &&
                data.concreteType === currentData.concreteType
            );
            
            if (existingDataIndex !== -1) {
                // Show the saved data section
                toggleSavedData();
                
                // Highlight the duplicate row with blinking animation
                highlightDuplicateRow(existingDataIndex);
                
                showMessage("This data is already saved. The existing data has been highlighted.", "error");
                return;
            }
            
            // Add to user's saved data
            currentUser.data.push(currentData);
            
            // Save to localStorage
            localStorage.setItem('currentConmixUser', JSON.stringify(currentUser));
            
            showMessage("Data saved successfully!", "success");
        }

        function toggleSavedData() {
            if (!currentUser) {
                showMessage("Please login to view your saved data.", "error");
                return;
            }
            
            const savedDataSection = document.getElementById('savedData');
            const displaySavedDataSection = document.getElementById('displaySavedData');
            
            if (savedDataSection.style.display === 'none') {
                displaySavedData();
                savedDataSection.style.display = 'block';
                displaySavedDataSection.style.display = 'none';
                // Scroll to the top of the saved data section
                savedDataSection.scrollIntoView({ behavior: 'smooth' });
            } else {
                savedDataSection.style.display = 'none';
            }
        }

        function displaySavedData() {
            const savedDataBody = document.getElementById('savedDataBody');
            savedDataBody.innerHTML = '';
            
            if (!currentUser || currentUser.data.length === 0) {
                savedDataBody.innerHTML = '<tr><td colspan="5" style="text-align: center;">No saved data found.</td></tr>';
                return;
            }
            
            currentUser.data.forEach((data, index) => {
                const row = document.createElement('tr');
                row.className = 'saved-data-item';
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${data.concreteType === 'highStrength' ? 'High Strength' : 'Conventional'}</td>
                    <td>${data.grade}</td>
                    <td>${data.timestamp}</td>
                    <td>
                        <button class="open-btn" onclick="openSavedData(${index})">Open</button>
                        <button class="delete-btn" onclick="deleteSavedData(${index})">Delete</button>
                        <button class="print-btn" onclick="printSpecificData(${index})">Download</button>
                    </td>
                `;
                savedDataBody.appendChild(row);
            });
        }

        function openSavedData(index) {
            const data = currentUser.data[index];
            const savedDataSection = document.getElementById('savedData');
            const displaySection = document.getElementById('displaySavedData');
            const content = document.getElementById('savedDataContent');
            
            // Store the index of the currently viewing data
            currentlyViewingDataIndex = index;
            
            // Create material quantities table
            let materialsTable = `
                <h3>Mix Proportions (per m³ of Concrete)</h3>
                <div style="overflow-x: auto;">
                    <table>
                        <tr>
                            <th>Material</th>
                            <th>Quantity (kg)</th>
                            <th>Ratio (by weight)</th>
                        </tr>
                        <tr>
                            <td>Cement</td>
                            <td>${data.cement.toFixed(2)}</td>
                            <td>1</td>
                        </tr>
            `;
            
            if (data.useFlyAsh) {
                materialsTable += `
                    <tr>
                        <td>Fly Ash</td>
                        <td>${data.flyAsh.toFixed(2)}</td>
                        <td>${(data.flyAsh / data.cement).toFixed(3)}</td>
                    </tr>
                `;
            }
            
            materialsTable += `
                    <tr>
                        <td>Water</td>
                        <td>${data.water.toFixed(2)}</td>
                        <td>${(data.water / data.cement).toFixed(3)}</td>
                    </tr>
                    <tr>
                        <td>Fine Aggregate</td>
                        <td>${data.fineAggregate.toFixed(2)}</td>
                        <td>${(data.fineAggregate / data.cement).toFixed(3)}</td>
                    </tr>
                    <tr>
                        <td>Coarse Aggregate</td>
                        <td>${data.coarseAggregate.toFixed(2)}</td>
                        <td>${(data.coarseAggregate / data.cement).toFixed(3)}</td>
                    </tr>
            `;
            
            if (data.useAdmixture) {
                materialsTable += `
                    <tr>
                        <td>Admixture</td>
                        <td>${data.admixture.toFixed(2)}</td>
                        <td>${(data.admixture / data.cement).toFixed(3)}</td>
                    </tr>
                `;
            }
            
            if (data.useSteelFibers) {
                materialsTable += `
                    <tr>
                        <td>Steel Fibers</td>
                        <td>${data.steelFibers.toFixed(2)}</td>
                        <td>${(data.steelFibers / data.cement).toFixed(3)}</td>
                    </tr>
                `;
            }
            
            materialsTable += '</table></div>';
            
            // Create input parameters table
            let inputParametersTable = `
                <h3>Input Parameters</h3>
                <div style="overflow-x: auto;">
                    <table>
                        <tr>
                            <th>Parameter</th>
                            <th>Value</th>
                        </tr>
                        <tr>
                            <td>Grade of Concrete</td>
                            <td>${data.grade}</td>
                        </tr>
                        <tr>
                            <td>Type of Concrete</td>
                            <td>${data.concreteType === 'highStrength' ? 'High Strength Concrete' : 'Conventional Concrete'}</td>
                        </tr>
                        <tr>
                            <td>Cement Type</td>
                            <td>${document.getElementById('cementType').options[document.getElementById('cementType').selectedIndex].text}</td>
                        </tr>
                        <tr>
                            <td>Nominal Maximum Aggregate Size</td>
                            <td>${data.inputParameters.aggSize} mm</td>
                        </tr>
                        <tr>
                            <td>Zone of Fine Aggregate</td>
                            <td>Zone ${data.inputParameters.zone}</td>
                        </tr>
                        <tr>
                            <td>Required Slump</td>
                            <td>${data.inputParameters.slump} mm</td>
                        </tr>
                        <tr>
                            <td>Specific Gravity of Cement</td>
                            <td>${data.inputParameters.spGravityCement}</td>
                        </tr>
                        <tr>
                            <td>Specific Gravity of Fine Aggregate</td>
                            <td>${data.inputParameters.spGravityFA}</td>
                        </tr>
                        <tr>
                            <td>Specific Gravity of Coarse Aggregate</td>
                            <td>${data.inputParameters.spGravityCA}</td>
                        </tr>
                        <tr>
                            <td>Water Absorption of FA</td>
                            <td>${data.inputParameters.absorptionFA}%</td>
                        </tr>
                        <tr>
                            <td>Water Absorption of CA</td>
                            <td>${data.inputParameters.absorptionCA}%</td>
                        </tr>
                        <tr>
                            <td>Water-Cement Ratio</td>
                            <td>${data.wcr}</td>
                        </tr>
            `;
            
            if (data.useFlyAsh) {
                inputParametersTable += `
                    <tr>
                        <td>Fly Ash Percentage</td>
                        <td>${data.inputParameters.flyAshPercentage}%</td>
                    </tr>
                    <tr>
                        <td>Specific Gravity of Fly Ash</td>
                        <td>${data.inputParameters.spGravityFlyAsh}</td>
                    </tr>
                `;
            }
            
            if (data.useAdmixture) {
                inputParametersTable += `
                    <tr>
                        <td>Admixture Percentage</td>
                        <td>${data.inputParameters.admixturePercentage}%</td>
                    </tr>
                    <tr>
                        <td>Specific Gravity of Admixture</td>
                        <td>${data.inputParameters.spGravityAdmixture}</td>
                    </tr>
                    <tr>
                        <td>Water Reduction Percentage</td>
                        <td>${data.inputParameters.waterReduction}%</td>
                    </tr>
                `;
            }
            
            if (data.useSteelFibers) {
                inputParametersTable += `
                    <tr>
                        <td>Steel Fiber Percentage</td>
                        <td>${data.inputParameters.steelFiberPercentage}%</td>
                    </tr>
                    <tr>
                        <td>Specific Gravity of Steel Fibers</td>
                        <td>${data.inputParameters.spGravitySteelFibers}</td>
                    </tr>
                `;
            }
            
            inputParametersTable += `
                        <tr>
                            <td>Exposure Condition</td>
                            <td>${data.exposure}</td>
                        </tr>
                        <tr>
                            <td>Concrete Structure</td>
                            <td>${data.concreteStructureType === 'plain' ? 'Plain Concrete' : 'Reinforced Concrete'}</td>
                        </tr>
                    </table>
                </div>
            `;
            
            content.innerHTML = `
                <div class="result-box">
                    <h3>Grade: ${data.grade}</h3>
                    <p>Type: ${data.concreteType === 'highStrength' ? 'High Strength Concrete' : 'Conventional Concrete'}</p>
                    <p>Target Strength: ${data.targetStrength} N/mm²</p>
                    <p>Water-Cement Ratio: ${data.wcr}</p>
                    <p>Exposure Condition: ${data.exposure}</p>
                    <p>Concrete Structure: ${data.concreteStructureType === 'plain' ? 'Plain Concrete' : 'Reinforced Concrete'}</p>
                    <p>Saved on: ${data.timestamp}</p>
                    ${materialsTable}
                    ${inputParametersTable}
                </div>
                <div class="chart-container">
                    <canvas id="savedMaterialChart"></canvas>
                </div>
            `;
            
            // Create pie chart for saved data
            createSavedMaterialChart(
                data.chartData.cement,
                data.chartData.flyAsh,
                data.chartData.water,
                data.chartData.fineAggregate,
                data.chartData.coarseAggregate,
                data.chartData.admixture,
                data.chartData.steelFibers
            );
            
            savedDataSection.style.display = 'none';
            displaySection.style.display = 'block';
            
            // Scroll to the saved data section
            displaySection.scrollIntoView({ behavior: 'smooth' });
        }

        function createSavedMaterialChart(cement, flyAsh, water, fineAgg, coarseAgg, admixture, steelFibers = 0) {
            const ctx = document.getElementById('savedMaterialChart').getContext('2d');
            
            // Destroy previous chart if exists
            if (savedMaterialChart) {
                savedMaterialChart.destroy();
            }
            
            // Prepare data for the chart
            const materials = [
                { name: 'Cement', value: cement, color: 'rgb(54, 162, 235)' },
                { name: 'Fly Ash', value: flyAsh, color: 'rgb(153, 102, 255)' },
                { name: 'Water', value: water, color: 'rgb(75, 192, 192)' },
                { name: 'Fine Aggregate', value: fineAgg, color: 'rgb(255, 159, 64)' },
                { name: 'Coarse Aggregate', value: coarseAgg, color: 'rgb(255, 99, 132)' },
                { name: 'Admixture', value: admixture, color: 'rgb(201, 203, 207)' },
                { name: 'Steel Fibers', value: steelFibers, color: 'rgb(128, 128, 128)' }
            ];
            
            // Filter out materials with zero value
            const filteredMaterials = materials.filter(material => material.value > 0);
            
            // Calculate total for percentages
            const total = filteredMaterials.reduce((sum, material) => sum + material.value, 0);
            
            savedMaterialChart = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: filteredMaterials.map(material => `${material.name} (${((material.value / total) * 100).toFixed(1)}%)`),
                    datasets: [{
                        data: filteredMaterials.map(material => material.value),
                        backgroundColor: filteredMaterials.map(material => material.color),
                        borderColor: 'white',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: {
                                font: {
                                    size: 14,
                                    family: "'Times New Roman', serif"
                                },
                                padding: 20
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.parsed;
                                    const percentage = ((value / total) * 100).toFixed(1);
                                    return `${label.split(' (')[0]}: ${value.toFixed(2)} kg (${percentage}%)`;
                                }
                            }
                        },
                        title: {
                            display: true,
                            text: 'Material Quantities per m³ of Concrete',
                            font: {
                                size: 16,
                                family: "'Times New Roman', serif"
                            }
                        }
                    }
                }
            });
        }

        function deleteSavedData(index) {
            // If index is not provided, use the currently viewing data index
            const dataIndex = index !== undefined ? index : currentlyViewingDataIndex;
            
            if (dataIndex === null || dataIndex === undefined) {
                showMessage("No data selected for deletion.", "error");
                return;
            }
            
            if (!confirm("Are you sure you want to delete this saved data?")) {
                return;
            }
            
            // Remove the data from the user's saved data
            currentUser.data.splice(dataIndex, 1);
            
            // Save to localStorage
            localStorage.setItem('currentConmixUser', JSON.stringify(currentUser));
            
            // Reset currently viewing data index
            currentlyViewingDataIndex = null;
            
            // Hide the display section and show the saved data list
            document.getElementById('displaySavedData').style.display = 'none';
            document.getElementById('savedData').style.display = 'block';
            
            // Refresh the saved data table
            displaySavedData();
            
            showMessage("Data deleted successfully!", "success");
        }

        function printSpecificData(index) {
            currentlyViewingDataIndex = index;
            downloadSavedDataAsPNG();
        }

        function downloadSavedDataAsPNG() {
            if (currentlyViewingDataIndex === null) {
                showMessage("No data selected for download.", "error");
                return;
            }
            
            const displaySection = document.getElementById('displaySavedData');
            
            // Use html2canvas to capture the saved data section as an image
            html2canvas(displaySection).then(canvas => {
                // Convert canvas to PNG image
                const imgData = canvas.toDataURL('image/png');
                
                // Create a temporary link to download the image
                const link = document.createElement('a');
                link.download = `ConMix_${currentUser.data[currentlyViewingDataIndex].grade}_${currentUser.data[currentlyViewingDataIndex].timestamp.replace(/[/:\\]/g, '_')}.png`;
                link.href = imgData;
                link.click();
                
                showMessage("Data downloaded as PNG successfully!", "success");
            });
        }

        function highlightDuplicateRow(index) {
            // Get all saved data rows
            const savedDataRows = document.querySelectorAll('#savedDataBody tr');
            
            // Remove any existing highlight
            savedDataRows.forEach(row => {
                row.classList.remove('duplicate-highlight');
            });
            
            // Add highlight to the duplicate row
            if (savedDataRows[index]) {
                savedDataRows[index].classList.add('duplicate-highlight');
                
                // Scroll to the highlighted row
                savedDataRows[index].scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        }

        // Initialize with a sample calculation
        window.onload = function() {
            checkUserLogin();
            highlightExposureCells();
            updateTargetStrengthPreview();
            handleCementTypeChange();
            handleExposureChange();
            handleConcreteTypeChange();
            validateWaterCementRatio();
        };
    </script>
</body>
</html>
